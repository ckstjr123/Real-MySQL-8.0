# 8. 인덱스

## 8.1 디스크 읽기 방식

### 8.1.2 랜덤 I/O와 순차 I/O
- 디스크에 데이터를 쓰고 읽는 데 걸리는 시간은 디스크 헤더를 움직여서 읽고 쓸 위치로 옮기는 단계에서 결정됨
- 랜덤 I/O라는 표현은 하드 디스크 드라이브의 플래터(원판)를 돌려서
  읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시킨 다음 데이터를 읽는 것을 의미
- 일반적으로 쿼리 튜닝은 쿼리를 처리하는 데 꼭 필요한 데이터만 읽도록 쿼리를 개선하여 랜덤 I/O 자체를 줄여주는 것이 목적
  
---

## 8.2 인덱스란?
- 책 마지막에 있는 '찾아보기'가 인덱스에 비유된다면
  책의 내용은 데이터 파일에 해당한다고 볼 수 있음
- DBMS의 인덱스도 컬럼의 값을 주어진 순서로 미리 정렬해서 보관함
- 인덱스는 데이터의 쓰기(INSERT, UPDATE, DELETE) 성능을 희생하는 대신 데이터의 읽기 속도를 높이는 기능

---

## 8.3 B-TREE 인덱스

### 8.3.1 구조 및 특성
<img width="936" height="680" alt="image" src="https://github.com/user-attachments/assets/1370a9f1-13bf-4aec-b103-d44a8888c003" />

### 8.3.2 B-TREE 인덱스 키 추가 및 삭제

#### 8.3.2.1 인덱스 키 추가
- B-TREE에 저장될 때는 저장될 키 값을 이용해 B-TREE 상의 적절한 위치를 검색해서 저장될 위치가 결정되면 레코드의 키 값과 대상 레코드의 정보를 리프 노드(페이지)에 저장
- 리프 노드가 꽉 차서 더는 저장할 수 없을 때 리프 노드가 분할(Split)돼야 하는데, 이는 상위 브랜치 노드까지 처리 범위가 넓어짐

#### 8.3.2.3 인덱스 키 변경
- 먼저 키 값을 삭제한 후 다시 새로운 키 값을 추가하는 방식으로 처리됨
- InnoDB 엔진을 사용하는 테이블에 대해서는 해당 작업 또한 체인지 버퍼를 활용해 지연 처리 가능

#### 8.3.2.4 인덱스 키 검색
- 루트 노드부터 시작해 브랜치 노드를 거쳐 최종 리프 노드까지 트리를 탐색하면서 비교 작업 수행
- 인덱스 트리 탐색은 UPDATE나 DELETE를 처리하기 위해 항상 해당 레코드를 먼저 검색해야 할 경우에도 사용됨

### 8.3.3 B-TREE 인덱스 사용에 영향을 미치는 요소
> 인덱스를 구성하는 # 8. 인덱스

## 8.1 디스크 읽기 방식

### 8.1.2 랜덤 I/O와 순차 I/O
- 디스크에 데이터를 쓰고 읽는 데 걸리는 시간은 디스크 헤더를 움직여서 읽고 쓸 위치로 옮기는 단계에서 결정됨
- 랜덤 I/O라는 표현은 하드 디스크 드라이브의 플래터(원판)를 돌려서
  읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시킨 다음 데이터를 읽는 것을 의미
- 일반적으로 쿼리 튜닝은 쿼리를 처리하는 데 꼭 필요한 데이터만 읽도록 쿼리를 개선하여 랜덤 I/O 자체를 줄여주는 것이 목적
  
---

## 8.2 인덱스란?
- 책 마지막에 있는 '찾아보기'가 인덱스에 비유된다면
  책의 내용은 데이터 파일에 해당한다고 볼 수 있음
- DBMS의 인덱스도 컬럼의 값을 주어진 순서로 미리 정렬해서 보관함
- 인덱스는 데이터의 쓰기(INSERT, UPDATE, DELETE) 성능을 희생하는 대신 데이터의 읽기 속도를 높이는 기능

---

## 8.3 B-Tree 인덱스

### 8.3.1 구조 및 특성
<img width="936" height="680" alt="image" src="https://github.com/user-attachments/assets/1370a9f1-13bf-4aec-b103-d44a8888c003" />

### 8.3.2 B-Tree 인덱스 키 추가 및 삭제

#### 8.3.2.1 인덱스 키 추가
- B-TREE에 저장될 때는 저장될 키 값을 이용해 B-TREE 상의 적절한 위치를 검색해서 저장될 위치가 결정되면 레코드의 키 값과 대상 레코드의 정리프 노드(페이지)에 저장
- 리프 노드가 꽉 차서 더는 저장할 수 없을 때 리프 노드가 분할(Split)돼야 하는데, 이는 상위 브랜치 노드까지 처리 범위가 넓어짐

#### 8.3.2.2 인덱스 키 변경
- 먼저 키 값을 삭제한 후 다시 새로운 키 값을 추가하는 방식으로 처리됨
- InnoDB 엔진을 사용하는 테이블에 대해서는 해당 작업 또한 체인지 버퍼를 활용해 지연 처리 가능

### 8.3.3 B-Tree 인덱스 사용에 영향을 미치는 요소
> 인덱스를 구성하는 컬럼 크기와 레코드 건수, 그리고 유니크한 인덱스 키 값의 개수 등에 의해 검색이나 변경 작업의 성능이 영향을 받음

#### 8.3.3.1 인덱스 키 값의 크기
- InnoDB 스토리지 엔진은 디스크에 데이터를 저장하는 가장 기본 단위를 페이지(Page) 또는 블록(Block)이라고 하며, 디스크의 모든 읽기 및 쓰기 작업의 최소 작업 단위가 됨
- 페이지의 기본 크기는 16KB
- 인덱스 키 값의 크기가 커질수록 한 페이지에 저장할 수 있는 키 개수는 줄어드므로 디스크로부터 읽어야 하는 횟수가 늘어남
- 또한 인덱스 키 값의 길이가 길어진다는 것은 인덱스의 크기가 커진다는 것을 의미하기 때문에, 인덱스 크기가 커질수록 버퍼 풀 메모리에 캐시해 둘 수 있는 레코드 수는 줄어듦







